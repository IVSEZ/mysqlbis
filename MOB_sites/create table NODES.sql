use rcbill_maps;

drop table if exists IV_NODES;

CREATE TABLE `IV_NODES` (
`NODEID` int not null auto_increment,
`NODENO`  varchar(255) DEFAULT NULL,
`NODEISLAND` varchar(255) DEFAULT NULL ,
`NODENAME` varchar(255) DEFAULT NULL ,
`NODETYPE` varchar(255) DEFAULT NULL ,
`NODEDISTRICT` varchar(255) DEFAULT NULL ,
`NODEOWNER` varchar(255) DEFAULT NULL ,
`NODEPARCEL` varchar(255) DEFAULT NULL ,
`NODELAT` varchar(255) DEFAULT NULL ,
`NODELONG` varchar(255) DEFAULT NULL ,
`NODECOORDX` varchar(255) DEFAULT NULL ,
`NODECOORDY` varchar(255) DEFAULT NULL ,
`NODEICON` varchar(255) DEFAULT NULL ,
`NODEICONSIZE` varchar(255) DEFAULT NULL ,
`NODEICONOFFSET` varchar(255) DEFAULT NULL ,
`NODESTATUS` varchar(255) DEFAULT NULL ,
`COMMENT` longtext DEFAULT NULL ,
`INSERTEDON` datetime DEFAULT NULL, 
`MODIFIEDON` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, 
primary key (`NODEID`) 
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- drop index IDXMS1 on IV_NODES;


CREATE INDEX IDXMS1
ON IV_NODES (NODENAME);


/*
insert into rcbill_maps.IV_NODES
(NODENO, NODEISLAND, NODENAME, NODETYPE, NODEHEIGHT, NODEOWNER, NODEPARCEL, NODELAT, NODELONG, NODECOORDX, NODECOORDY, NODEICON, NODEICONSIZE, NODEICONOFFSET, NODESTATUS, COMMENT) 
values ('312', 'MAHE', 'La Misere', 'GBT' , '35M','GOS','B4484','-4.670381','55.473643','','','','','','Approved','DC/894/20(DC/338/20)')
;
*/



-- select * from rcbill_maps.IV_NODES;
/*

select @@version as version;


ALTER TABLE rcbill_maps.IV_NODES RENAME COLUMN NODEHEIGHT TO NODEDISTRICT;
ALTER TABLE rcbill_maps.IV_NODES CHANGE NODEHEIGHT NODEDISTRICT VARCHAR(255);

SET SESSION sql_mode = 'ALLOW_INVALID_DATES';
SET safe_update

SET SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

ALTER TABLE  rcbill_maps.IV_NODES
DROP COLUMN INSERTEDON;

alter table rcbill_maps.IV_NODES
add column `INSERTEDON` datetime DEFAULT CURRENT_TIMESTAMP
;

alter table rcbill_maps.IV_NODES
add column `MODIFIEDON` datetime ON UPDATE NOW() after INSERTEDON
;

select * from rcbill_maps.IV_NODES;

CREATE TABLE rcbill_maps.IV_NODES_BKP LIKE rcbill_maps.IV_NODES;
INSERT INTO rcbill_maps.IV_NODES_BKP SELECT * FROM rcbill_maps.IV_NODES;


CREATE TABLE rcbill_maps.IV_NODES LIKE rcbill_maps.IV_NODES_BKP;
INSERT INTO rcbill_maps.IV_NODES SELECT * FROM rcbill_maps.IV_NODES_BKP;


INSERT INTO  rcbill_maps.IV_NODES(NODEID, NODENO, NODEISLAND, NODENAME, NODETYPE, NODEHEIGHT, NODEOWNER, NODEPARCEL, NODELAT, NODELONG, NODECOORDX, NODECOORDY, NODEICON, NODEICONSIZE, NODEICONOFFSET, NODESTATUS, COMMENT)
 SELECT * FROM rcbill_maps.IV_NODES_BKP;

select * from rcbill_maps.IV_NODES_BKP;

set sql_safe_updates=0;
update rcbill_maps.IV_NODES set NODEICONSIZE='40,40';

update rcbill_maps.IV_NODES set insertedon='2021-06-22';

update rcbill_maps.IV_NODES set modifiedon='2021-06-22';


-- select 	"lat",	"lon",	"title",	"description",	"icon",	"iconSize",	"iconOffset"
select NODElat as lat, NODElong as lon, NODEname as title, 
concat_ws("<BR>",NODENO,NODENAME,NODETYPE,NODEISLAND,NODEOWNER,NODEPARCEL,NODELAT,NODELONG, NODECOORDX,NODECOORDY,NODESTATUS,COMMENT) as description
from rcbill_maps.IV_NODES
;





1	312	MAHE	LA MISERE	GBT	GOS	B4484	-4.670381	55.473643			icon/green_tower.png	30,30	-20,-20	APPROVED	DC/894/20(DC/338/20)
2	296	MAHE	ANCHOR CAFE	GBT	GOS	C10339	-4.74708	55.49331			icon/green_tower.png	30,30	-20,-20	APPROVED	DC/342/20
3	231	MAHE	PROVIDENCE	PALM	GOS	V21016	-4.649573	55.479334			icon/palm-tree.png	30,30	-20,-20	ERECTED	PALM TREE HAS BEEN ERECTED. EQUIPMENT TO BE INSTALLED
4	183	MAHE	AV BUILDING	RTP	PRIVATE (AV GROUP)	V5513	-4.62262	55.45013			icon/building1.png	30,30	-20,-20	APPROVED	WAITING FOR WMC REPORT ON WHERE TO INSTALL
5	161	MAHE	INDEPENDENCE	RTP	PRIVATE		-4.623599	55.454766			icon/building1.png	30,30	-20,-20	PENDING	WAITING
6	122	MAHE	LA BATIE	GBP	GOS		-4.605612	55.436075			icon/pole1.png	30,30	-20,-20	PENDING	PENDING
7	171	MAHE	PERSEVERANCE	GBT	AIRTEL		-4.60471	55.46204			icon/red_tower.png	30,30	-20,-20	PENDING	TEST
8	242	MAHE	ANSE FAURE	GBT	SBC		-4.683761111	55.52859444			icon/yellow_tower.png	30,30	-20,-20	PENDING	NEED TO GET PERMISSION
9	311	MAHE	BARBARONS	GBT	BBC		-4.68033	55.454			icon/black_tower.png	30,30	-20,-20	PENDING	PENDING
11	202	MAHE	STADIUM	GBT	OTHER		-4.63617	55.47109			icon/tower1.png	30,30	-20,-20	PENDING	PENDING
12	151	MAHE	MONT BUXTON	GBT	GOS	V21114	-4.612716	55.447746			icon/green_tower.png	30,30	-20,-20	APPROVED	DC/372/20
																														

*/