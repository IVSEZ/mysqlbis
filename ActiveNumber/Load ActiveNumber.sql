use rcbill_my;

-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-27102016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-01052016 - 31082016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-01092016 - 29102016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-30102016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-31102016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-01112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-02112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-03112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-04112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-05112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-06112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-07112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-08112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-09112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-10112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-11112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-12112016-13112016.csv'

-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-14112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-15112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-16112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-17112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-18112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-19112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-20112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-21112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-22112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-23112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-24112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-25112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-26112016-27112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-28112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-29112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-30112016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-01122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-02122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-03122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-04122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-05122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-06122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-07122016-08122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-09122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-10122016-11122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/DailySubscriptionStats-12122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-13122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-14122016-15122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-16122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-17122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-18122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-19122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-20122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-21122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-22122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-23122016-26122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-27122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-28122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-29122016.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-30122016.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-31122016-02012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-03012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-04012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-05012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-06012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-07012017-09012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-10012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-11012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-12012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-13012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-14012017-15012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-16012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-17012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-18012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-19012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-20012017.csv' 
-- LOAD DATA LOW_PRIORITY LOCAL INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-21012017-22012017.csv' 
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-23012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-24012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-25012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-26012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-27012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-28012017-29012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-30012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-31012017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-01022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-02022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-03022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-04022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-05022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-06022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-07022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-08022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-09022017-10022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-11022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-12022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-13022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-14022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-15022017-16022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-17022017-19022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-20022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-21022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-22022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-23022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-24022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-25022017-26022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-27022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-28022017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-01032017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-02032017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-03032017.csv'
-- LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-10052017-11052017.csv'
 LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/activenumber/DailySubscriptionStats-04052017.csv'

INTO TABLE rcbill_my.activenumber 
FIELDS TERMINATED BY ',' LINES TERMINATED BY '\r\n' 
IGNORE 1 LINES 
(
@periodorig,
@baseservice,
@service,
@servicetypeold,
@clientclassold,
@regionallevel3,
@regionallevel2,
@regionallevel1,
@regionold,
@distributor,
@promotion,
@validity,
@open,
@new,
@newconverted,
@renew,
@closed,
@closednonpayment,
@suspended,
@closedconverted,
@closedother,
@disconnected,
@disconnectedtotal,
@disconnectedall,
@connected,
@connectedtotal,
@pendingorders
) 
set 
activenumberid=null,
periodorig = @periodorig,
period = (select substring_index(@periodorig,';',1)),
periodday = (select extract(day from period)),
periodmth = (select extract(month from period)),
periodyear = (select extract(year from period)),
weekday=(select dayname(period)),
mthname=(select monthname(period)),
baseservice = @baseservice,
service = @service,
servicecategory = (select servicecategory from rcbill_my.lkpbaseservice where service=@service),
servicesubcategory = (select servicesubcategory from rcbill_my.lkpbaseservice where service=@service),

servicetypeold = @servicetypeold,
servicetypeold1 = (select servicenewtype from rcbill_my.lkpservicetype where servicetype=@servicetypeold),
servicetype = (select GetServiceType(servicetypeold,servicetypeold1,service)),

clientclassold = @clientclassold,
clientclass = (select NewClientClass from rcbill_my.lkpclienttype where origclientclass=@clientclassold),
clienttype = (select clienttype from rcbill_my.lkpclienttype where origclientclass=@clientclassold),

regionallevel1 = @regionallevel1,
regionallevel2 = @regionallevel2,
regionallevel3 = @regionallevel3,
regionold = @regionold,
region = (select newregion from rcbill_my.lkpregion where origregion=@regionold),

distributor = @distributor,
promotion = @promotion,
validity = @validity,

open = @open,
new = @new,
newconverted = @newconverted,
renew = @renew,
closed = @closed,
closednonpayment = @closednonpayment,
suspended = @suspended,
closedconverted = @closedconverted,
closedother = @closedother,
disconnected = @disconnected,
disconnectedtotal = @disconnectedtotal,
disconnectedall = @disconnectedall,
connected = @connected,
connectedtotal = @connectedtotal,
pendingorders = @pendingorders,

totalopened = (new+newconverted+renew),
totalclosed = (closed+closednonpayment+closedconverted+closedother),
difference = (totalopened - totalclosed),
totalcheck = (open+new+newconverted+renew+closed+closednonpayment+closedconverted+closedother+disconnected+disconnectedtotal+disconnectedall+connected+connectedtotal),
decommissioned = (select IsDecom(totalcheck)),
reported = (select reported from rcbill_my.lkpreported where servicenewtype=servicetype)
;
